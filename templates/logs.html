{% extends "base.html" %}
{% block content %}

<div class="playlist-header">
    <div class="logs-header-row">
        <h2>üìú System Logs</h2>
        
        <div class="logs-actions">
            
            <label class="switch-container">
                <input type="checkbox" id="log-toggle" {% if settings.logging_enabled %}checked{% endif %} onchange="toggleLogging()">
                <span class="switch-label">
                    {% if settings.logging_enabled %}Recording ON üü¢{% else %}Recording OFF üî¥{% endif %}
                </span>
            </label>

            <button onclick="clearLogs()" class="btn-delete" style="padding: 8px 15px; font-size:0.9em;">Clear Logs üóëÔ∏è</button>
            <button onclick="location.reload()" class="btn-preview" style="padding: 8px 15px; font-size:0.9em;">Refresh üîÑ</button>
        </div>
    </div>
    <p class="media-sub">Track collection syncs, cache updates, and system errors.</p>
</div>

<div class="card logs-table-container">
    <div style="overflow-x: auto;">
        <table class="logs-table">
            <thead>
                <tr>
                    <th style="width: 180px;">Timestamp</th>
                    <th style="width: 100px;">Module</th>
                    <th style="width: 100px;">Level</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td style="color: #888;">{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td><code>{{ log.module }}</code></td>
                    <td>
                        {% if log.level == 'INFO' %}
                            <span class="log-badge info">INFO</span>
                        {% elif log.level == 'SUCCESS' %}
                            <span class="log-badge success">SUCCESS</span>
                        {% elif log.level == 'WARNING' %}
                            <span class="log-badge warning">WARN</span>
                        {% elif log.level == 'ERROR' %}
                            <span class="log-badge error">ERROR</span>
                        {% else %}
                            <span class="log-badge default">{{ log.level }}</span>
                        {% endif %}
                    </td>
                    <td style="line-height: 1.4;">{{ log.message }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="text-center" style="padding: 30px; color: #666;">No logs found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function toggleLogging() {
    const enabled = document.getElementById('log-toggle').checked;
    fetch('/toggle_logging', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({enabled: enabled})
    })
    .then(r => r.json())
    .then(d => {
        if(d.status === 'success') location.reload();
        else alert("Error: " + d.message);
    });
}

function clearLogs() {
    if(!confirm("Are you sure you want to delete all history?")) return;
    fetch('/clear_logs', {method: 'POST'})
    .then(r => r.json())
    .then(d => {
        if(d.status === 'success') location.reload();
        else alert("Error: " + d.message);
    });
}
</script>

{% endblock %}