{% extends "base.html" %}

{% block content %}
<div class="login-wrapper">
    <div class="login-card">
        
        <div class="auth-toggle">
            <button type="button" class="toggle-btn active" id="tab-login" onclick="setMode('login')">
                Log In
            </button>
            <button type="button" class="toggle-btn" id="tab-register" onclick="setMode('register')">
                Register
            </button>
        </div>
        
        <div class="auth-body">
            <form id="auth-form" method="POST" action="{{ url_for('login') }}" onsubmit="return validateForm()">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" name="username" id="username" required placeholder="Enter username..." autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" id="password" required placeholder="••••••••" autocomplete="current-password">
                </div>

                <div class="form-group hidden-field" id="confirm-container">
                    <label>Confirm Password</label>
                    <input type="password" id="confirm_password" placeholder="••••••••" autocomplete="new-password">
                </div>
                
                <button type="submit" class="login-btn" id="submit-btn">
                    Sign In
                </button>
            </form>

            <div class="auth-footer" id="auth-footer-text">
                Welcome back to SeekAndWatch
            </div>
        </div>
    </div>
</div>

<script>
    // UI state
    let currentMode = 'login'; 

    // Honor server-provided state (e.g., deep link to register).
    {% if is_register %}
    document.addEventListener('DOMContentLoaded', () => setMode('register'));
    {% endif %}

    function setMode(mode) {
        currentMode = mode;
        const form = document.getElementById('auth-form');
        const submitBtn = document.getElementById('submit-btn');
        const confirmBox = document.getElementById('confirm-container');
        const confirmInput = document.getElementById('confirm_password');
        const footer = document.getElementById('auth-footer-text');
        
        // Tabs
        const tabLogin = document.getElementById('tab-login');
        const tabRegister = document.getElementById('tab-register');

        if (mode === 'login') {
            // Visual state
            tabLogin.classList.add('active');
            tabRegister.classList.remove('active');
            
            // Form behavior
            form.action = "{{ url_for('login') }}";
            submitBtn.innerText = "Sign In";
            footer.innerText = "Welcome back to SeekAndWatch";
            
            // Hide confirm password
            confirmBox.classList.remove('visible-field');
            confirmBox.classList.add('hidden-field');
            confirmInput.required = false;
            
        } else {
            // Visual state
            tabRegister.classList.add('active');
            tabLogin.classList.remove('active');
            
            // Form behavior
            form.action = "{{ url_for('register') }}";
            submitBtn.innerText = "Create Account";
            footer.innerText = "Your watch history, reimagined.";
            
            // Show confirm password
            confirmBox.classList.remove('hidden-field');
            confirmBox.classList.add('visible-field');
            confirmInput.required = true;
        }
    }

    function validateForm() {
        if (currentMode === 'register') {
            const p1 = document.getElementById('password').value;
            const p2 = document.getElementById('confirm_password').value;
            
            if (p1 !== p2) {
                alert("⚠️ Passwords do not match!");
                return false; // Stop submission.
            }
        }
        return true; // Allow submission.
    }
</script>
{% endblock %}